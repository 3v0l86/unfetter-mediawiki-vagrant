# vim: filetype=apache sts=4 sw=4 autoindent
#####################################################################
### THIS FILE IS MANAGED BY PUPPET
#####################################################################

ServerName multiwiki
ServerAlias *.wiki.local.wmftest.net

# Set environment flag that will tell LocalSettings.php that we want to use
# the multiwiki settings management system.
SetEnv MULTIWIKI 1

ServerAdmin http://www.mediawiki.org/wiki/MediaWiki-Vagrant
DocumentRoot <%= @docroot %>
LogLevel error

<Directory />
    Options FollowSymLinks
    AllowOverride None
</Directory>

<Directory <%= @docroot %>>
    Require all granted
</Directory>

<Directory <%= scope['::mediawiki::dir'] %>>
    Require all granted
</Directory>

<Directory <%= @upload_dir %>>
    Require all granted
</Directory>

AllowEncodedSlashes on

Alias /w <%= scope['::mediawiki::dir'] %>
Alias /images <%= @upload_dir %>
Alias /mediawiki-vagrant.png /var/www/mediawiki-vagrant.png
Alias /favicon.ico /var/www/favicon.ico

<IfDefine !ZEND>
  ProxyPass         /wiki                fcgi://127.0.0.1:9000/<%= @docroot %>/index.php retry=0
  ProxyPass         /w/extensions        !
  ProxyPassMatch    ^/w/(.*\.(php|hh))$  fcgi://127.0.0.1:9000/<%= @docroot %>/$1 retry=0
  RewriteRule       ^/$                  fcgi://127.0.0.1:9000/<%= @docroot %>/index.php  [P]
</IfDefine>

<IfDefine ZEND>
  Alias /wiki <%= @docroot %>/index.php
</IfDefine>
