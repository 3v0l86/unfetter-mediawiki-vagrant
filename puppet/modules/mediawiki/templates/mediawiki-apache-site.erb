# vim: filetype=apache sts=4 sw=4 autoindent
#
# Apache site configuration for MediaWiki
# This file is managed by Puppet.
#
ServerName vagrant
ServerAdmin http://www.mediawiki.org/wiki/Vagrant
DocumentRoot "/var/www"
LogLevel error

<Directory />
    Options FollowSymLinks
    AllowOverride None
</Directory>

<Directory /var/www/>
</Directory>

<Directory <%= scope['mediawiki::dir'] %>>
    Require all granted
</Directory>

<Directory <%= scope['mediawiki::upload_dir'] %>>
    Require all granted
</Directory>

AllowEncodedSlashes on
RewriteEngine On

Alias /w "<%= scope['mediawiki::dir'] %>"
Alias /images "<%= scope['mediawiki::upload_dir'] %>"
Alias /mediawiki-vagrant.png /var/www/mediawiki-vagrant.png
Alias /favicon.ico /var/www/favicon.ico

<IfDefine !ZEND>
    ProxyPass       /wiki                fcgi://127.0.0.1:9000/<%= scope['::mediawiki::dir'] %>/index.php
    ProxyPass       /w/extensions        !
    ProxyPassMatch  ^/w/(.*\.(php|hh))$  fcgi://127.0.0.1:9000/<%= scope['::mediawiki::dir'] %>/$1
    RewriteRule     ^/$                  fcgi://127.0.0.1:9000/<%= scope['::mediawiki::dir'] %>/index.php  [P]
</IfDefine>

<IfDefine ZEND>
    RewriteRule ^/$ /w/index.php [R=301]
    Alias /wiki "<%= scope['mediawiki::dir'] %>/index.php"
</IfDefine>
